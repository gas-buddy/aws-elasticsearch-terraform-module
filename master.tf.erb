# This file is generated by an ERB template. Do not edit it directly.
<% %w(a b c d e).each do |az| -%>

resource "aws_instance" "master_<%= az %>" {
  count = "${contains(keys(var.subnet_ids), "<%= az %>") ? 1 : 0}"

  instance_type = var.master_instance_type
  ami = var.hvm_ami
  key_name = var.key_name
  iam_instance_profile = var.iam_instance_profile_name
  vpc_security_group_ids = concat(var.additional_security_group_ids, list(aws_security_group.elasticsearch_master.id))
  subnet_id = lookup(var.subnet_ids, "<%= az %>", "")
  monitoring = var.master_monitoring

  tags = merge(var.tags, map("Name", "elasticsearch-master-${var.cluster_name}-<%= az %>", "Job", "elasticsearch-master"))

  lifecycle {
    ignore_changes = [
      ami
    ]
  }
}
<% end -%>
