# This file is generated by an ERB template. Do not edit it directly.
<% %w(a b c d e).each do |az| -%>

resource "aws_instance" "data_<%= az %>" {
  count = contains(keys(var.subnet_ids), "<%= az %>") ? (var.data_nodes_per_subnet) : 0

  instance_type = var.data_instance_type
  ami = var.hvm_ami
  key_name = var.key_name
  iam_instance_profile = var.iam_instance_profile_name
  vpc_security_group_ids = concat(var.additional_security_group_ids, list(aws_security_group.elasticsearch_data.id))
  subnet_id = lookup(var.subnet_ids, "<%= az %>", "")
  monitoring = var.data_monitoring

  tags = merge(var.tags, map("Name", format("elasticsearch-data-%s-<%= az %>-%d", var.cluster_name, count.index+1), "Job", "elasticsearch-data"))

  lifecycle {
    ignore_changes = [
      ami
    ]
  }
}
<% end -%>
